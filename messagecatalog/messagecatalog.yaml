openapi: 3.0.0
info:
  title: Cloud Native Message Catalog
  version: "0.1"
paths:
  /messagedefinition:
    get:
      description: "Direct access to a particular message definition document providing a version URI"
      operationId: getMessageDefinitionVersionByURI
      parameters:
        - in: query
          name: uri
          required: true
          schema:
            type: string
          description: "Message definition version URI (requires percent-encoding)."
      responses:
        "200":
          $ref: "#/components/schemas/MessageDefinitionVersion"
        "404":
          description: "Specified message definition version not found"
  /messagecatalog:
    get:
      summary: "Get list of message definition groups"
      description: "Get all message definition groups in namespace."
      operationId: getGroups
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MessageDefinitionGroup"
      tags:
        - "groups"
    post:
      summary: Create message definition group
      description: Create message definition group with specified format in catalog.
      operationId: createGroup
      requestBody:
        description: message definition group description
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageDefinitionGroup"
      responses:
        "201":
          description: Created
          headers:
            Location:
              schema:
                type: string
        "409":
          description: MessageDefinition group already exists
      tags:
        - "groups"
  /messagecatalog/{group-id}:
    parameters:
      - name: group-id
        in: path
        description: message definition group
        required: true
        schema:
          type: string
    get:
      summary: Get message definition group
      description: Get message definition group description in catalog.
      operationId: getGroup
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageDefinitionGroup"
        "404":
          description: Specified group not found
      tags:
        - "groups"

    put:
      summary: Create or update message definition group
      description: Create or update message definition group with specified format in catalog.
      operationId: createGroup
      requestBody:
        description: message definition group description
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageDefinitionGroup"
      responses:
        "200":
          description: Ok when created or updated
          headers:
            Location:
              schema:
                type: string
        "409":
          description: MessageDefinition group already exists
      tags:
        - "groups"
    delete:
      summary: Delete message definition group
      description: Delete message definition group from catalog. This also deletes all content of the group.
      operationId: deleteGroup
      responses:
        "204":
          description: OK no content
        "404":
          description: Specified group not found
      tags:
        - "groups"
  /messagecatalog/{group-id}/messagedefinitions:
    parameters:
      - name: group-id
        in: path
        description: message definition group
        required: true
        schema:
          type: string
    get:
      tags:
        - "groups"
      summary: List message definitions for this message definition group
      description: Returns message definitions by group id.
      operationId: getMessageDefinitionsByGroup
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MessageDefinitionVersion"
        "404":
          description: Group not found
    post:
      summary: Register message definition
      description: >
        Register message definition.
        If message definition of specified name does not exist in specified group, message definition is created at version 1.
        If message definition of specified name exists already in specified group, message definition is created at latest version + 1.
        If message definition with identical content already exists, existing message definition's ID is returned.
      operationId: createMessageDefinition
      requestBody:
        description: message definition content
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageDefinitionVersion"
      responses:
        "200":
          $ref: "#/components/schemas/MessageDefinitionVersion"
        "400":
          description: Invalid request
      tags:
        - "registration"
  /messagecatalog/{group-id}/messagedefinitions/{messagedefinition-id}:
    parameters:
      - name: group-id
        in: path
        description: message definition group
        required: true
        schema:
          type: string
      - name: messagedefinition-id
        in: path
        description: message definition id
        required: true
        schema:
          type: string
    get:
      summary: Get latest version of message definition
      description: Get latest version of message definition.
      operationId: getLatestMessageDefinition
      responses:
        "200":
          $ref: "#/components/schemas/MessageDefinitionVersion"
      tags:
        - "message definitions"
    delete:
      summary: Delete message definition.
      operationId: deleteMessageDefinition
      responses:
        "204":
          description: OK no content
        "404":
          description: Matching message definition not found
      tags:
        - "message definitions"
  /messagecatalog/{group-id}/messagedefinitions/{messagedefinition-id}/versions:
    parameters:
      - name: group-id
        in: path
        description: message definition group
        required: true
        schema:
          type: string
      - name: messagedefinition-id
        in: path
        description: message definition id
        required: true
        schema:
          type: string
    get:
      summary: Get list of versions
      description: Get list of versions for specified message definition
      operationId: getMessageDefinitionVersions
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MessageDefinitionVersion"
      tags:
        - "versions"
  ? /messagecatalog/{group-id}/messagedefinitions/{messagedefinition-id}/versions/{version-number}
  : parameters:
      - name: group-id
        in: path
        description: message definition group
        required: true
        schema:
          type: string
      - name: messagedefinition-id
        in: path
        description: message definition id
        required: true
        schema:
          type: string
      - name: version-number
        in: path
        description: version number
        required: true
        schema:
          type: integer
    get:
      summary: Get specified version of message definition
      operationId: getMessageDefinitionVersion
      responses:
        "200":
          $ref: "#/components/schemas/MessageDefinitionVersion"
        "404":
          description: Specified message definition not found
      tags:
        - "versions"
    delete:
      summary: Delete specified version of message definition
      operationId: deleteMessageDefinitionVersion
      responses:
        "204":
          description: OK no content
      tags:
        - "versions"
components:
  schemas:
    MessageDefinitionGroup:
      type: object
      properties:
        id:
          type: string
        format:
          type: string
        description:
          type: string
        documentation:
          type: string
        documentationformat:
          type: string
        tags:
          type: string
        createdtimeutc:
          type: string
          format: date-time
        updatedtimeutc:
          type: string
          format: date-time
        groupProperties:
          type: object
          additionalProperties:
            type: string
    MessageDefinitionVersion:
      type: object
      properties:
        id:
          type: string
        version:
          type: string
        authority:
          type: string
        format:
          type: string
          format: uri
        description:
          type: string
        tags:
          type: string
        documentation:
          type: string
        documentationformat:
          type: string
        createdtimeutc:
          type: string
          format: date-time
        updatedtimeutc:
          type: string
          format: date-time
        definition:
          oneOf:
            - $ref: "#/components/schemas/CloudEventsMetaSchema"
            - $ref: "#/components/schemas/AMQPMetaSchema"
            - $ref: "#/components/schemas/MQTTMetaSchema"
            - $ref: "#/components/schemas/NATSMetaSchema"
            - type: object
              description: "Allows for any other metaschema object"
    CloudEventsMetaSchema:
      type: object
      properties:
        attributes:
          type: object
          properties:
            specversion:
              type: string
              default: "1.0"
            id:
              type: string
            source:
              type: string
            subject:
              type: string
            type:
              type: string
            datacontenttype:
              type: string
            dataschema:
              type: string
          required:
            - "type"
    AMQPMetaSchema:
      type: object
      properties:
        header:
          type: object
          properties:
            durable:
              type: boolean
            priority:
              type: number
            ttl:
              type: number
        deliveryannotations:
          type: object
        messageannotations:
          type: object
        properties:
          type: object
          properties:
            messageid:
              type: string
            userid:
              type: string
            to:
              type: string
            subject:
              type: string
            replyto:
              type: string
            correlationid:
              type: string
            contenttype:
              type: string
            contentencoding:
              type: string
            absoluteexpirytime:
              type: string
            creationtime:
              type: string
            groupid:
              type: string
            groupsequence:
              type: string
            replytogroupid:
              type: string
        applicationdata:
          type: object
          properties:
            dataschema:
              type: string
              format: uri
              description: "reference to a schema object"
            amqpencoding:
              type: string
              enum:
                - "Data"
                - "Value"
                - "Sequence"
        applicationproperties:
          type: object
        footer:
          type: object
    MQTTMetaSchema:
      type: object
      properties:
        publish:
          type: object
          properties:
            mqttversion:
              type: string
              default: "5.0"
            qos:
              type: number
            retain:
              type: boolean
            topicname:
              type: string
            payloadformat:
              type: number
            expiryinterval:
              type: number
            responsetopic:
              type: string
            correlationdata:
              type: string
            contenttype:
              type: string
        userproperty:
          type: object
        payload:
          type: object
          properties:
            dataschema:
              type: string
              format: uri
              description: "reference to a schema object"
    NATSMetaSchema:
      type: object
      properties:
        pub:
          type: object
          properties:
            subject:
              type: string
            replyto:
              type: string
        payload:
          type: object
          properties:
            dataschema:
              type: string
              format: uri
              description: "reference to a schema object"
