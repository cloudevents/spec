# מפרט CloudEvents - גרסה 1.0.3 -בתהליך כתיבה

## תקציר

מפרט הCloudEvents הוא דרך להגדרת מבני נתונים של אירועים(eventים) בצורה ניטרלית לספקיות טכנולוגיה. 

## תוכן **עניינים** 

- [סקירה כללית](#סקירה-כלליתoverview)
- [סימון וטרמינולוגיה](#סימון-וטרמינולוגיהnotations-and-terminology)
- [מאפייני הקשר](#מאפייני-הקשרcontext-attributes)
- [נתוני אירוע](#נתוני-אירועevent-data)
- [מגבלות גודל](#מגבלות-גודלsize-limits)
- [פרטיות ואבטחה](#פרטיות-ואבטחהprivacy-and-security)
- [דוגמה](#דוגמהexample)

## סקירה כללית/Overview

אירועים (eventים) נמצאים בכל מקום. אבל יצרני אירועים נוטים לתאר אותם בצורות שונות. 

המחסור בדרך אחידה לתיאור אירועים גורם לכך שמפתחים צריכים ללמוד כל פעם מחדש איך לצרוך את האירועים האלו. בנוסף לכך מחסור זה מגביל את הפוטנציאל ליצירה של ספריות, כלים ותשתיות המיועדים להעברה של נתוני אירועים דרך מערכות, דוגמת SDKים, נתבי אירועים (event routers) או מערכות מעקב (tracing) . באופן כללי הפורטביליות והפרודוקטיביות שיכולים להיות מופקים מנתוני האירועים האלו נפגעים. 

מפרט הCloudEvents מיועד לתיאור נתוני אירוע בפורמטים קבועים כדי לאפשר שיתוף פעולה הדדי בין שירותים, פלטפורמות ומערכות.

פורמטים שונים קובעים כיצד לקודד אירוע מסוג CloudEvent לפורמטי קידוד ספציפיים. מימושים תקינים של CloudEvents התומכים בפורמטים אלו **חייבים** לעקוב אחרי חוקי הקידוד המוגדרים בפורמט האירוע המתאים. כל המימושים **חייבים** לממש את התמיכה ב[פורמט JSON](formats/json-format.md)

לעוד מידע על ההיסטורי, פיתוח והגיון מאחורי בחירות העיצוב של המפרט ניתן לקרוא במסמך [מבוא לCloudEvents](primer.md).

## סימון וטרמינולוגיה/Notations and Terminology

### מוסכמות סימון/Notational Conventions

מילות המפתח ״**חייב** (MUST)״, ״**אסור** (MUST NOT)״, “**חובה** (REQUIRED)״, ״**תהא** (SHALL)״, ״**לא** (SHALL NOT)״, ״**צריך** (SHOULD)״, ״**לא צריך** (SHOULD NOT)״, ״**מומלץ** (RECOMMENDED)״, ״**יכול** (MAY)״, ״**אפשרי** (OPTIONAL)״ אשר מופיעות במסמך, צריכות להיות מפורשות כמתואר במסמך [RFC 2119](http://tools.ietf.org/html/rfc2119).

הבהרה - כאשר פיצ'ר מסוים מקוטלג כ"**אפשרי**" הכוונה היא ש**אפשרי** כי גם [היצרן](#יצרןproducer) וגם [הצרכן](#צרכןconsumer) של הודעה יתמכו בפיצ'ר המדובר. במילים אחרות, יצרן יכול לבחור לכלול פיצ'ר מסוים בהודעה אם הוא רוצה בכך, והצרכן יכול לבחור אם לתמוך בפיצ'ר הזה אם הוא רוצה בכך. צרכן אשר לא תומך בפיצ'ר רשאי לנקוט בכל פעולה, כולל חוסר פעולה או פליטת שגיאה, כל עוד הוא לא מפר אף דרישה שנקבעה על ידי מפרט זה. עם זאת, הפעולה **המומלצת** היא התעלמות מהפיצ'ר. יצרן **צריך** להיות מוכן לאפשרות שבה צרכן יתעלם מהפיצ'ר המדובר. [מתווך](#מתווךintermediary) **צריך** להעביר הלאה מאפיינים **אפשריים**.

### טרמינולוגיה

מפרט זה מגדיר את המונחים הבאים:

#### התרחשות/Occurrence

"התרחשות" היא לכידה של הצהרת עובדה במהלך פעולת מערכת תוכנה. התרחשות עשויה להתרחש בגלל אות שהועלה על ידי המערכת או אות שנצפה על ידי המערכת, בגלל שינוי מצב, בגלל טיימר שחלף, או כל פעילות אחרת ראויה לציון. לדוגמה, מכשיר עשוי להיכנס למצב התראה בגלל שהסוללה חלשה, או שמכונה וירטואלית עומדת לבצע אתחול מחדש שתוזמן מראש.

#### אירוע/Event

"אירוע" הוא רשומת נתונים המבטאת התרחשות וההקשר שלה. אירועים מנותבים מיצרן אירועים (המקור) לצרכני אירועים מתעניינים. ניתן לבצע את הניתוב על סמך מידע הכלול באירוע, אך אירוע לא יזהה יעד ניתוב ספציפי. אירועים יכילו שני סוגים של מידע: נתוני האירוע המייצגים את ההתרחשות ונתוני המסגרת של ההקשר המספקים מידע הקשרי על ההתרחשות. התרחשות בודדת **יכולה** לגרום ליצירה של יותר מאירוע אחד.

#### יצרן/Producer

ה"יצרן" הוא תהליך, מכשיר ספציפי או מופע תוכנתי היוצר את מבנה הנתונים אשר מתאר את ה-CloudEvent.

#### מקור/Source

ה"מקור" הוא ההקשר שבו התרחשה ההתרחשות. במערכת מבוזרת מקור עשוי להיות מורכב ממספר [יצרנים](#יצרןproducer). אם מקור אינו מודע ל-CloudEvents, יצרן חיצוני יוצר את ה-CloudEvent בשם המקור.

#### צרכן/Consumer

"צרכן" מקבל את האירוע ופועל על פיו. הוא משתמש בהקשר ובנתונים כדי לבצע היגיון מסוים, שיכול להוביל להתרחשות של אירועים חדשים.

#### מתווך/Intermediary

"מתווך" מקבל הודעה המכילה אירוע לצורך העברתה למקבל הבא, שיכול להיות מתווך אחר או [צרכן](#צרכןconsumer). משימה טיפוסית של מתווך היא לנתב את האירוע למקבלים בהתבסס על המידע ב[מאפייני ההקשר](#מאפייני-הקשרcontext-attributes).

#### הקשר/Context

נתוני המסגרת של ההקשר יהיו מובלעים ב[מאפייני ההקשר](#מאפייני-הקשרcontext-attributes). כלים וקוד אפליקטיבי יכולים להשתמש במידע זה כדי לזהות את הקשר של אירועים להיבטים של המערכת או לאירועים אחרים.

#### נתונים/Data

מידע ספציפי לעולם הבעיה הנוגע להתרחשות (כלומר המטען). מידע זה עשוי לכלול מידע על ההתרחשות, פרטים על הנתונים שהשתנו במהלך ההתרחשות או דברים נוספים. עיין בסעיף [נתוני אירוע](#נתוני-אירועevent-data) למידע נוסף.

#### פורמט האירוע/Event Format

פורמט האירוע מציין כיצד לקודד CloudEvent כרצף של בתים. פורמטים עצמאיים של אירועים, כגון [פורמט JSON](formats/json-format.md), מציינים קידוד ללא תלות בכל פרוטוקול או מדיום אחסון. [מיפויי פרוטוקולים](#מיפוי-פרוטוקולprotocol-binding) **יכולים** להגדיר פורמטים התלויים בפרוטוקול.

#### הודעה/Message

אירועים מועברים ממקור ליעד באמצעות הודעות.

"הודעה במצב מובנה" היא הודעה שבה כל האירוע (מאפיינים ונתונים) מקודדים בגוף ההודעה.

"הודעה במצב בינארי" היא הודעה שבה נתוני האירוע מאוחסנים בגוף ההודעה, ומאפייני ההקשר מאוחסנים כחלק מנתוני המסגרת של ההודעה.

לעתים קרובות, נעשה שימוש במצב בינארי כאשר יצרן ה-CloudEvent מעוניין להוסיף את נתוני מסגרת של ה-CloudEvent לאירוע קיים מבלי להשפיע על גוף ההודעה. ברוב המקרים CloudEvent המקודד כהודעה במצב בינארי לא ישבור את העיבוד של המקבל הקיים של האירוע מכיוון שנתוני המסגרת של ההודעה מאפשרים בדרך כלל תכונות של הרחבה. במילים אחרות, CloudEvent בפורמט בינארי יעבוד גם עבור מקבל תומך CloudEvents וגם עבור אחד שאינו מודע ל-CloudEvents.

#### פרוטוקול/Protocol

ניתן להעביר הודעות באמצעות פרוטוקולי תעשייה סטנדרטיים (למשל HTTP, AMQP, MQTT, SMTP), פרוטוקולי קוד פתוח (למשל Kafka, NATS), או פרוטוקולים ספציפיים לפלטפורמה/ספקית (AWS Kinesis, Azure Event Grid).

#### מיפוי פרוטוקול/Protocol Binding

מיפוי פרוטוקול מתאר כיצד נשלחים ומתקבלים אירועים על פני פרוטוקול נתון.

מיפויי פרוטוקולים **יכולים** לבחור להשתמש ב[פורמט אירוע](#פורמט-האירועevent-format
) ספציפי כדי למפות אירוע ישירות לתוכן מעטפת התעבורה, או לחלופין **יכולים** לספק פירמוט ומבנה נוספים למעטפה. לדוגמה, ניתן להשתמש במעטפת סביב הודעה במצב מובנה, או שמספר הודעות יכולות להיות מצורפות יחד לתוכן מעטפת התעבורה.

### מאפייני הקשר/Context Attributes

כל CloudEvent התואם למפרט זה **חייב** לכלול מאפייני הקשר המוגדרים כ**חובה**, **יכול** לכלול מאפיין הקשר **אפשרי** אחד או יותר ו**יכול** לכלול אחד או יותר [מאפייני הקשר מורחבים](#הרחבת-מאפייני-הקשרextension-context-attributes). כל מאפיין הקשר **חייב** להופיע רק פעם אחת ב-CloudEvent. מאפייני ההקשר המוגדרות במפרט זה (בניגוד למאפייני הקשר מורחבים) ידועים כ"מאפייני הקשר ליבתיים".

על אף שמאפייני ההקשר מתארים את האירוע, הם מתוכננים בצורה כזאת שניתן לפרש אותם ללא תלות בפירוש נתוני האירוע. תכונה זאת מאפשרת לבחון את מאפייני ההקשר בקבלה מבלי להידרש לפרש את נתוני האירוע כלל.

#### מוסכמת שמות/Naming Convention

מפרטי CloudEvents מגדירים מיפויים לפרוטוקולים וקידודים שונים, וה-CloudEvents SDK הנלווים מכוונים לסביבות הרצה ושפות שונות. חלק מאלה מתייחסים לחלקים מנתוני המסגרת כרגישים לאותיות גדולות בעוד שאחרים לא, ו-CloudEvent בודד עשוי להיות מנותב דרך מספר תחנות בדרך הכוללות שילוב של פרוטוקולים, קידודים וזמני ריצה. לכן, מפרט זה מגביל את ערכת התווים הזמינה של כל המאפיינים כך שנמנעות בעיות של רגישות לאותיות גדולות או התנגשויות עם תווים מותרים עבור מזהים בשפות נפוצות.

על מנת למקסם את הסבירות של יכולת פעולה הדדית וניידות בין פרוטוקולי תעבורה ופורמטי העברת הודעות, שמות המאפיינים של CloudEvents **חייבים** להיות מורכבים מאותיות אנגלית קטנות ('a' עד 'z') או ספרות ('0' עד '9') מה-ASCII סט תווים. שמות מאפיינים **צריכים** להיות תיאוריים ותמציתיים ואורכם **לא צריך** לעלות על 20 תווים.

לאף מאפיין CloudEvent **אסור** להיקרא `data` ; שם זה שמור מכיוון שהוא משמש בפורמטי אירוע מסוימים. 

#### סוגי טיפוסים/Type System

טיפוסי הנתונים המופשטים הבאים זמינים לשימוש בהגדרת מאפיינים. כל אחד מהטיפוסים הללו **יכול** להיות מיוצג באופן שונה על ידי פורמט אירוע שונים ובשדות נתוני המסגרת של הפרוטוקול. מפרט זה מגדיר קידוד מחרוזת קנוני עבור כל טיפוס **שחייב** להיות נתמך על ידי כל מימוש. 

* `Boolean` - ערך בוליאני של "אמת" או "שקר"
  * קידוד למחרוזת - ערך רגיש לאותיות גדולות - `true` או `false`

* `Integer` - מספר שלם בטווח של 2,147,483,648- 2,147,483,647+ כולל. זה הוא הטווח של מספר מסומן, 32 סיביות בשיטת המשלים ל2. פורמטי אירוע לא חייבים להשתמש בקידוד הזה, אבל הם **חייבים** להשתמש רק בערכי מספר ים בטווח הנתון. 
  * קידוד למחרוזת - Integer Component כמוגדר תחת [RFC 7159 פסקה 6](https://tools.ietf.org/html/rfc7159#section-6)  עם סימן מינוס אופציונאלי בתחילת המחרוזת.
* `String` - מחרוזות של תווים המותרים בקידוד Unicode. התווים הבאים אסורים: 
  * תווי שליטה בטווחים  U+0000-U+001F ו U+007F-U+009F (בשני הטווחים הקצוות כלולים). הסיבה לכך היא שלרובם אין משמעות מוסכמת וחלקם כמו U+000A (ירידת שורה), לא שמישים במקרים מסוימים דוגמת HTTP Headers.
  * ערכים [המוגדרים כ"לא-תווים" לפי Unicode](http://www.unicode.org/faq/private_use.html#noncharacters)
  * ערכים המוגדרים כSurrogates והם U+D800-U+DBFF ו  U+DC00-U+DFFF, שניהם כוללים את הקצוות. אלה אם כן נמצאים בשימוש של זוגות בצורה תקינה. לכן בסימון JSON הערך "\uDEAD" לא יהיה תקין כי זה כSurrogate ללא זוג, אבל  "\uD800\uDEAD" כן יהיה תקין.
* `Binary` - סדרה של בתים
  * קידוד למחרוזת - קידוד Base64 כמוגדר תחת [RFC4648](https://tools.ietf.org/html/rfc4648).

* `URI` - מזהה משאב אחיד מוחלט
  * קידוד למחרוזת - `Absolute URI` כמוגדרת תחת  [RFC 3986 Section 4.3](https://tools.ietf.org/html/rfc3986#section-4.3).
* `URI-reference` - הפניה אחידה למזהה משאב.
  * קידוד למחרוזת - `URI-reference` כמוגדרת תחת  [RFC 3986 Section 4.1](https://tools.ietf.org/html/rfc3986#section-4.1).
* `Timestamp` - ביטוי תאריך וזמן בלוח שנה הגרגוריאני
  * קידוד למחרוזת - [RFC 3339](https://tools.ietf.org/html/rfc3339). 

כל ערכי מאפייני ההקשר **חייבים** להיות מאחד הטיפוסים המפורטים למעלה. ערכי מאפיין **יכולים** להיות מוצגים כטיפוסי מערכת או כמחרוזות קנוניות.

מודל תכנות בעל טיפוסים חזקים המייצג CloudEvent או כל הרחבה **חייב** להיות מסוגל להמיר מהקידוד הקנוני של המחרוזת ואל הטיפוס מערכת של סביבת-הריצה או השפה המתאים ביותר לטיפוס המופשט.

לדוגמה, מאפיין הזמן עשוי להיות מיוצג על ידי טיפוס התאריך והשעה המקורי של השפה ביישום נתון, אך הוא **חייב** להיות ניתן להשמה ממחרוזת RFC3339, והוא **חייב**  להיות ניתן להמרה למחרוזת RFC3339 כאשר הוא ממופה לשדה מסגרת של הודעת HTTP.

יישום מיפוי פרוטוקול CloudEvents או יישום פורמט אירוע **חייב** להיות מסוגל להמיר מ-ואל קידוד המחרוזות הקנוני לטיפוס הנתונים המתאים בקידוד או בערכי נתוני המסגרת של פרוטוקול.

ערך תכונה מסוג `Timestamp` אכן עשוי להיות מנותב כמחרוזת דרך מספר תחנות ולהתממש רק כטיפוס מערכת ייעודי רק אצל היצרן והצרכן הסופי. חותמת הזמן עשויה להיות מנותבת גם כטיפוס פרוטוקול ייעודי ועשוי להיות ממופה אל ו-מ טיפוסי המערכת  המתאימים בקצה היצרן והצרכן, ולעולם לא תתממש כמחרוזת.

הבחירה במנגנון הקידוד תקבע כיצד מאפייני ההקשר ונתוני האירוע יקודדו. לדוגמה, במקרה של קידוד JSON, מאפייני ההקשר ונתוני האירוע עשויים להופיע בתוך אותו אובייקט JSON.

### מאפייני **חובה**/REQUIRED Attributes

**חובה** על כל מאפיין מוגדר מטה להיות נוכח בכל CloudEvent.

#### מזהה/id

* טיפוס: `String`
* תיאור: מזהה את האירוע. יצרנים **חייבים** להבטיח ש `source` + `id`יהיו ייחודיים עבור כל אירוע ספציפי. אם אירוע משוכפל נשלח מחדש (לדוגמה בגלל בעיית רשת) הוא **יכול** להכיל את אותו ה`id`. צרכנים יכולים להניח שאירועים עם `source` ו`id` זהים הם שכפולים.
* אילוצים:
  * **חובה**
  * **חייב** להיות מחרוזת לא-ריקה
  * **חייב** להיות ייחודי במסגרת היצרן
* דוגמאות:
  * מונה אירועים המתוחזק על ידי היצרן
  * UUID

#### מקור/source

* טיפוס: `String`
* תיאור: מזהה את ההקשר שבו קרה אירוע. לרוב זה יכלול מידע כמו, סוג מקור האירוע, הארגון המפרסם את האירוע או התהליך שייצר את האירוע. התחביר והסמנטיקה המדויקים מאחורי הנתונים המקודדים ב-URI מוגדרים על ידי יצרן האירוע
  היצרנים **חייבים** להבטיח `source` + `id` יהיו ייחודיים עבור כל אירוע ייחודי.
  אפליקציה **יכולים** להקצות מקור ייחודי לכל יצרן נפרד, מה שמקל על יצירת זיהויים ייחודיים מכיוון שלאף יצרן אחר לא יהיה אותו מקור. האפליקציה עשויה להשתמש ב-UUIDs, URNs, רשויות DNS או סכמה ספציפית לאפליקציה כדי ליצור מזהי מקור ייחודיים.
  מקור עשוי לכלול יותר מיצרן אחד. במקרה זה, היצרנים חייבים לשתף פעולה כדי להבטיח שה`source` + `id` יהיו ייחודיים עבור כל אירוע ייחודי.
* אילוצים:
  * **חובה**
  * **חייב** להיות מחרוזת URI-Reference לא-ריקה
  * URI אבסולוטי **מומלץ** 
* דוגמאות:
  * URI ייחודי ברחבי האינטרנט עם סמכות DNS
    * `https://github.com/cloudevents`
    * `mailto:cncf-wg-serverless@lists.cncf.io`
  * URN ייחודי אוניברסלי עם UUID
    * `urn:uuid:6e8bc430-9c3a-11d9-9669-0800200c9a66`
  * מזהים ספציפיים לאפליקציה
    * `/cloudevents/spec/pull/123`
    * `/sensors/tn-1234567/alerts`
    * `1-555-123-4567`

#### גרסאת-מפרט/specversion

* טיפוס: `String`
* תיאור: הגרסה של מפרט CloudEvents שבה משתמש האירוע. זה מאפשר את הפרשנות של ההקשר. יצרני אירועים  **חייבים** להשתמש בערך של `1.0` כאשר הם מתייחסים לגרסה זו של המפרט.
  נכון לעכשיו, מאפיין זה יכלול רק את מספרי הגרסה 'major' ו-'Minor'. זה מאפשר לבצע שינויי 'תיקון' במפרט מבלי לשנות את הערך של מאפיין זה בקידוד. הערה: עבור מהדורות 'מועמד לשחרור' עשויה לשמש סיומת למטרות בדיקה.
* אילוצים
  * **חובה**
  * **חייב** להיות מחרוזת לא-ריקה

#### סוג/type

* טיפוס: `String`
  * תיאור: מאפיין זה מכיל ערך המתאר את סוג האירוע הקשור להתרחשות המקור. לעתים קרובות מאפיין זה משמש עבור ניתוב, צפייה, אכיפת מדיניות וכו'. הפורמט של ערך זה מוגדר על ידי היצרן ויכול לכלול מידע כגון גרסה של ה`type` - ראה [גרסאות של CloudEvents במבוא](primer.md) למידע נוסף.
* אילוצים: 
  * **חובה**
  * **חייב** להיות מחרוזת לא-ריקה
  * **צריך** להכיל קידומת עם שם DNS הפוך. ערך הקידומת מכתיב את הארגון שמגדיר את הסמנטיקה של סוג אירוע זה.
* דוגמאות:
  * `com.github.pull_request.opened`
  * `com.example.object.deleted.v2`

### מאפיינים **אפשריים**/OPTIONAL Attributes

מאפייני ההקשר הבאים **יכולים** להיות חלק מCloudEvent. עיין בסעיף [מוסכמות סימון](#מוסכמות-סימוןnotational-conventions) למידע נוסף על ההגדרה של מאפיין **אפשרי**

#### טיפוס-תוכן-נתונים/datacontenttype

- טיפוס: `String` על פי [RFC 2046](https://tools.ietf.org/html/rfc2046)
  - תיאור: סוג התוכן של ערך ה`data`. תכונה זו מאפשרת ל`data` לשאת כל סוג של תוכן, לפיו הפורמט והקידוד עשויים להיות שונים מאלו של פורמט האירוע הנבחר. לדוגמה, אירוע שעובד באמצעות [פורמט מעטפת JSON](formats/json-format.md) עשוי לשאת מטען XML ב`data`, והצרכן מודע לעובדה זאת בכך שערך המאפיין הזה הושם ל"application/xml". הכללים לאופן עיבוד תוכן ה`data` עבור ערכי `datacontenttype` שונים מוגדרים במפרטי פורמטי אירועים ספציפיים; לדוגמה, פורמט האירוע JSON מגדיר את היחס [בסעיף 3.1]().
    עבור חלק ממיפויי הפרוטוקול במצב בינארי, שדה זה ממופה ישירות לשדה ה`content-type ` בנתוני מסגרת של הפרוטוקול. ניתן למצוא כללים נורמטיביים עבור המצב הבינארי ומיפוי ה`content-type` בנתוני המסגרת בפרוטוקול המתאים.
    בחלק מפורמטי האירוע השדה `datacontenttype` **יכול** להיזרק. לדוגמה אם באירוע בפורמט JSON אין מאפיין `datacontenttype`, אז מונח כי `data` הוא ערך המתאים לסוג תוכן "application/json". במילים אחרות, אירוע בפורמט JSON ללא מאפיין `datacontenttype` שווה ערך לאותו אירוע עם `datacontenttype="application/json"`
    כאשר מתרגמים אירוע ללא שדה `datacontenttype` לפורמט אירוע או מיפוי פרוטוקול שונה, ה`datacontenttype` של התרגום **צריך** להיות מושם להיות הערך המונח של `datacontenttype` באירוע מקור 
- אילוצים:
  - **אפשרי**
  - אם קיים, **חייב** להתאים לפורמט מוגדרת תחת [RFC 2046](https://tools.ietf.org/html/rfc2046)
- דוגמאות סוגי תוכן ניתן לראות תחת  [IANA Media Types](http://www.iana.org/assignments/media-types/media-types.xhtml)

#### סכמת-נתונים/dataschema

* טיפוס: `URI`
* תיאור: מזהה את הסכמה שאליה ה`data` תואם. שינויים לא תואמים בסכמה **צריכים** לבוא לידי ביטוי ב-URI אחר. ראו [ גירסאות של CloudEvents ב-Primer](primer.md) למידע נוסף.
* הגבלות:
  * **אפשרי**
  * אם קיים, **חייב** להיות `URI` לא-ריק

#### נושא/subject

* טיפוס: `String`
* תיאור: מאפיין זה מתאר את נושא האירוע בהקשר של יצרן האירוע (מזוהה על ידי `source`). בתרחישי פרסום-הרשמה, מנוי בדרך כלל ירשם לאירועים הנפלטים על ידי `source`, אך ייתכן שמזהה `source` לבדו לא יספיק כסמכא לאירוע ספציפי כלשהו אם להקשר של  `source` יש תת-מבנה פנימי.
  זיהוי נושא האירוע במאפייני ההקשר של האירוע (בניגוד למטען ה`data` בלבד) מועיל במיוחד בתרחישי סינון מנויים גנריים שבהם תוכנת האמצע אינה מסוגלת לפרש את התוכן של`data`. בדוגמה שלמעלה, המנוי עשוי להתעניין רק בblobים עם שמות המסתיימים ב-'.jpg' או '.jpeg' והמאפיין `subject` מאפשר לבנות מסנן סיומת מחרוזת פשוט ויעיל עבור אותה תת-קבוצה של אירועים.
* אילוצים:
  * **אפשרי**
  * אם קיים, **חייב** להיות מחרוזת לא-ריקה
* דוגמה: מנוי עשוי להירשם לעדכוני אירועים של blobים חדשים נוצרים בתוך שירות אכסון blobים. במקרה זה, `source` האירוע מזהה את היקף הרישום (שירות האכסון), המאפיין `type` מזהה את האירוע "blob נוצר", ו`id` מזהה באופן ייחודי את מופע האירוע כדי להבחין בהתרחשויות נפרדות של blob בעל שם זהה שנוצר; השם של הblob החדש שנוצר יינשא בשדה `subject`
  * `source`: `https://example.com/storage/tenant/container`
  * `subject`: `mynewfile.jpg`

#### זמן/time

* טיפוס: `Timestamp`
* תיאור: חותמת זמן של מתי התרחשה ההתרחשות. אם לא ניתן לקבוע את זמן ההתרחשות, **אפשרי** שתכונה זו תוגדר לזמן אחר (כגון הזמן הנוכחי) על ידי יצרן CloudEvents, אולם כל היצרנים של אותו `source` **חייבים** להיות עקביים מבחינה זו. במילים אחרות, או שכולם משתמשים בזמן האמיתי של ההתרחשות או שכולם משתמשים באותו אלגוריתם כדי לקבוע את הערך שבו נעשה שימוש.
* אילוצים
  * **אפשרי**
  * אם קיים, **חייב** להתאים לפורמט המתואר תחת [RFC 3339](https://tools.ietf.org/html/rfc3339)

### הרחבת מאפייני הקשר/Extension Context Attributes

אירועי CloudEvent **יכולים** לכלול כל מספר שלמאפייני הקשר נוספים עם שמות ייחודיים, המכונים "מאפייני הרחבה". מאפייני הרחבה **חייבים** לפעול לפי אותה [מוסכמות שמות](#מוסכמות-סימוןnotational-conventions) ולהשתמש באותם [סוגי טיפוסים](#סוגי-טיפוסיםtype-system) כמו המאפיינים הסטנדרטיים. לתכונות הרחבה אין משמעות מוגדרת במפרט זה, הן מאפשרות למערכות חיצוניות לצרף מטא נתונים לאירוע, בדומה לHTTP custom headers.

מאפייני הרחבה מקודדים תמיד לפי הכללים המחייבים כמו המאפיינים הסטנדרטיים. עם זאת, מפרט זה אינו מונע מהרחבה להעתיק ערכי מאפייני הקשר של אירוע לחלקים אחרים של הודעה, על מנת ליצור אינטראקציה עם מערכות שאינן CloudEvents שגם מעבדות את ההודעה. מפרטי הרחבה שעושים זאת **צריכים** לציין כיצד על הצדק המקבל לפרש הודעות אם הערכים המועתקים שונים מהערכים המקודדים של הCloudEvent. 

#### הגדרת הרחבות/Defining Extensions

ראה [הרחבת מאפייני הקשר בCloudEvent](primer.md) למידע נוסף הנוגע לשימוש והגדרה של הרחבות.

ההגדרה של הרחבה **צריכה** להגדיר באופן מלא את כל ההיבטים של מאפיין- למשל. השם, הסוג, המשמעות הסמנטית והערכים האפשריים שלו. הגדרות הרחבות חדשות **צריכות** להשתמש בשם מספיק תיאורי כדי להפחית את הסיכויים להתנגשות שמות עם הרחבות אחרות. במיוחד, מחברי ההרחבות **צריכים** לבדוק את מסמך ההרחבות המתועד עבור קבוצת ההרחבות הידועות - לא רק עבור התנגשויות שמות אפשריות אלא עבור הרחבות שעשויות לעניין אותם. 

פרוטוקולים רבים תומכים ביכולת של שולחים לכלול נתוני מסגרת נוספים, למשל HTTP headers. בעוד שהמקבל של CloudEvents אינו מחויב לעבד ולהעביר אותם הלאה, **מומלץ** לעשות זאת באמצעות מנגנון כלשהו שמבהיר שהם אינם נתוני מסגרת של CloudEvents.

הנה דוגמה שממחישה את הצורך במאפיינים נוספים. במקרים רבים של צרכי IoT וארגונים גדולים, אירוע יכול להיות בשימוש של אפליקציית serverless המבצעת פעולות על פני מספר סוגים של אירועים. כדי לתמוך במקרים של שימוש כאלה, יצרן האירוע יצטרך להוסיף מאפייני זהות נוספים ל"מאפייני ההקשר" שבהם יוכלו צרכני האירוע להשתמש כדי להצליב את האירוע הזה עם האירועים האחרים. אם מאפייני זהות כאלה הן במקרה חלק מה"data" של האירוע, יצרן האירוע יוסיף גם את מאפיין הזהות ל"מאפייני ההקשר", כך שצרכני אירועים יוכלו לגשת בקלות למידע זה מבלי צורך לפענח ולבחון את נתוני האירוע. מאפייני זהות כאלה יכולים לשמש גם כדי לתחנות ביניים לקבוע כיצד לנתב את האירועים.

## נתוני אירוע/Event Data

כמוגדרת תחת [נתונים](#נתוניםdata), CloudEvents **יכול**  לכלול מידע ספציפי לדומיין על ההתרחשות. כאשר קיים, מידע זה יהיה מובלע בתוך `data`.

* תיאור: מטען האירוע. מפרט זה אינו מציב כל הגבלה על סוג המידע הזה. הוא מקודד לפורמט מדיה שצוין על ידי המאפיין `datacontenttype` (למשל application/json), ונצמד לפורמט `dataschema` כאשר תכונות אלה קיימות.
* אילוצים:
  * **אפשרי**

## מגבלות גודל/Size Limits

בתרחישים רבים, CloudEvents יעברו דרך מתווך גנרי אחד או יותר, שכל אחד מהם עשוי להטיל מגבלות על גודל האירועים המועברים. CloudEvents עשויים להיות מנותבים גם לצרכנים, כמו מכשירי embedded שהם מוגבלים לאחסון או זיכרון ולכן הם מתקשים בהתמודדות עם אירועים בודדים גדולים.

ה"גודל" של אירוע הוא הגודל של "על-הקו"  וכולל כל ביט שמועבר על הקו עבור האירוע: נתוני המסגרת של פרוטוקול, נתוני המסגרת של האירוע ונתוני האירוע, בהתבסס על פורמט האירוע הנבחר ומיפוי הפרוטוקול הנבחר.

אם תצורת אפליקציה דורשת ניתוב אירועים על פני פרוטוקולים שונים או קידוד מחדש של אירועים, **צריך** לשקול את הפרוטוקול והקידוד הפחות יעילים שבהם השתמש האפליקציה לצורך עמידה במגבלות הגודל הללו:

* מתווכים **חייבים** להעביר אירועים בגודל של 64 KiB או פחות.
* צרכנים **צריכים** לקבל אירועים בגודל של לפחות 64 KiB.

למעשה, כללים אלה יאפשרו ליצרנים לפרסם אירועים בגודל של עד KiB בבטחה. הכוונה ל"בטוח" אומר שבדרך כלל סביר לצפות שהאירוע יתקבל וישודר מחדש על ידי כל המתווכים. ולכל צרכן ניתן השליטה, אם הוא רוצה לקבל או לדחות אירועים בסדר גודל כזה או אחר משיקולים אישיים.

בדרך כלל, מפרסמי CloudEvents **צריכים** לשמור על אירועים קומפקטיים על ידי הימנעות מהטמעת פריטי נתונים גדולים בנתוני האירועים שהלם, אלא להשתמש בנתוני האירועים כדי לקשר לפריטי נתונים כאלה. מנקודת מבט של בקרת הרשאות, גישה זו מאפשרת גם הפצה רחבה יותר של אירועים, מכיוון שגישה לפרטים הקשורים לאירועים באמצעות גישה לקישורים מאפשרת בקרת הרשאות מובחנת וחשיפה סלקטיבית, במקום להטמיע פרטים רגישים ישירות באירוע.

## פרטיות ואבטחה/Privacy and Security

יכולת פעולה הדדית היא המניע העיקרי מאחורי מפרט זה, כדי לאפשר התנהגות כזו נדרשת הצגת מידע מסוים בצורה ברורה, וכתוצאה מכך קיים פוטנציאל לדליפת מידע.

שקול את הדברים הבאים כדי למנוע דליפה בשוגג, במיוחד בעת מינוף פלטפורמות ורשתות תקשורת של צד שלישי:

* מאפייני הקשר
  **לא צריך** לשאת או לייצג מידע רגיש בתכונות ההקשר.
  יצרנים, צרכנים ומתווכים של CloudEvent **יכולים** לבחון, לרשום ולתעד מאפייני הקשר.

* נתוני אירוע
  [נתוני אירוע](#נתוני-אירועevent-data) ספציפיים לדומיין **צריכים** להיות מוצפנים כדי להגביל את החשיפה לגורמים מהימנים. המנגנון המופעל להצפנה כזו הוא הסכם בין יצרנים לצרכנים ולפיכך מחוץ לתחום מפרט זה.

* מיפוי פרוטוקולים
  **צריך** להפעיל אבטחה ברמת הפרוטוקול כדי להבטיח החלפה מהימנה ומאובטחת של CloudEvents.

## דוגמה/Example

הדוגמה הבאה מציגה CloudEvent מקודד כ-JSON:

```json
{
    "specversion" : "1.0",
    "type" : "com.github.pull_request.opened",
    "source" : "https://github.com/cloudevents/spec/pull",
    "subject" : "123",
    "id" : "A234-1234-1234",
    "time" : "2018-04-05T17:31:00Z",
    "comexampleextension1" : "value",
    "comexampleothervalue" : 5,
    "datacontenttype" : "text/xml",
    "data" : "<much wow=\"xml\"/>"
}
```

